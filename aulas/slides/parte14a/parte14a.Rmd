---
title: ME414 - Estatística para Experimentalistas
subtitle: Parte 14
output:
  ioslides_presentation:
    widescreen: yes
logo: ../logo-imecc.png
---

# Distribuição amostral

## Estimar uma proporção: Eleições para a prefeitura {.build}

<img src="figuras/image-from-rawpixel-id-409554-original.jpg" width=270 style="float: right; margin-left: 30px">


> * Quero saber se o candidato $A$ vai ganhar as eleições para prefeito.

> * Quero saber parâmetro populacional $p$ = proporção de pessoas que votam em $A$.

> * Posso esperar o resultado das eleições para saber, ou seja, teríamos as respostas de todas as pessoas da cidade.

> * Posso usar uma amostra para estimar a proporção de votos para $A$.

> * Quão boa é a estimativa? É precisa? 

> * Posso pensar no problema de duas formas: Modo 1 e Modo 2.


## Modo 1 {.build}

<img src="figuras/image-from-rawpixel-id-439565-original.jpg" width=270 style="float: right; margin-left: 30px">


> * Cidade com $N$ pessoas.

> * $X_i = 1$ se a pessoa $i$ vota em $A$

> * $X_i=0$ se a pessoa $i$ não vota em $A$.

> * $\mathbf{X}=(X_1,X_2,\ldots,X_N)$: respostas de toda a população (temos no dia da eleição).

> * Média populacional: $$p=\frac{1}{N}\sum_{i=1}^N X_i$$

<!-- Repare que aqui, nao estou falando de variáveis aleatórias, temos apenas dados das pessoas da cidade -->
<!-- Estou calculando a média populacional e a variancia, conforme vimos nas estatísticas descritivas -->

## Modo 1 {.smaller}

<img src="figuras/image-from-rawpixel-id-408061-original.jpg" width=270 style="float: right; margin-left: 30px">


* Variância populacional:

$$\begin{eqnarray} 
\sigma^2&=&\frac{1}{N}\sum_{i=1}^N(X_i-p)^2\\
&=&\frac{1}{N}\sum_{i=1}^N(X_i^2-2pX_i+p^2)\\
&=&\frac{\sum_{i=1}^N X_i^2-2p\sum_{i=1}^N X_i+\sum_{i=1}^N p^2}{N}\\
&=&\frac{\sum_{i=1}^N X_i-2p\sum_{i=1}^N X_i+\sum_{i=1}^N p^2}{N}\\
&=&\frac{Np-2pNp+Np^2}{N}=p(1-p)
\end{eqnarray}$$


## Modo 1 {.build}

> * $p$ = proporção de pessoas que votam em $A$ na cidade

> * $\sigma^2=p(1-p)$ é a variância da população.

> * Até o dia da eleição, não sabemos $p$.

> * Coletamos uma amostra aleatória de tamanho $n$ para uma pesquisa eleitoral.

> * $\hat{p}$: proporção de pessoas que votam em $A$ na amostra.

> * Quão boa é a estimativa? É precisa? 

> * Se outra pessoa também coleta uma amostra aleatória de tamanho $n$ e calcula $\hat{p}$ teremos o mesmo valor?

## Modo 1 - Exemplo $N=5$ e $n=2$ {.build}


$$\mathbf{X}=(X_1,X_2,\ldots,X_5)=(1,0,1,0,1)$$

$$p=\frac{\sum_{i=1}^5X_i}{5}=\frac{3}{5}=0.6$$

$$\begin{eqnarray} 
\sigma^2&=&\frac{1}{5}\sum_{i=1}^N(X_i-p)^2\\
&=&\frac{3\times(1-0.6)^2+2\times(0-0.6)^2}{5}\\
&=&0.24\\
&=&p(1-p)
\end{eqnarray}$$

## Modo 1 - Exemplo $N=5$ e $n=2$

Gráfico de barras (proporção) dos dados populacionais:

```{r,echo=FALSE,fig.align='center'}
namess <- c("0","1")
barplot(c(0.4,0.6), names.arg=namess, col="blue", main="", 
            cex.lab=1.0, cex.axis=1.0, cex.names=1.0, cex.main=2, las=2)
```


## Modo 1 - Exemplo $N=5$ e $n=2$ {.smaller}

$N^n=25$ amostras possíveis.
```{r,echo=FALSE,warning=FALSE,message=FALSE}
library(kableExtra)
aa <- expand.grid(1:5,1:5)
xx <- c(1,0,1,0,1)
phat <- unlist(apply(aa,1,function(x) mean(xx[x])))
aa$phat <- phat
#colnames(aa) <- c("Pessoa amostrada 1","Pessoa amostrada 2","$\\hat{p}$")
kable(aa,align = 'ccc',col.names = c("Primeira pessoa","Segunda pessoa","$\\hat{p}$"))
```

## Modo 1 - Exemplo $N=5$ e $n=2$ {.build}

Distribuição **amostral** de $\hat{p}$:

```{r,echo=FALSE,warning=FALSE,message=FALSE}
ff <- as.data.frame(table(aa$phat))
ff$Prop=ff$Freq/(sum(ff$Freq))
kable(ff[,c(1,3)],align = 'cc',col.names = c("$x$","$P(\\hat{p}=x)$"))
```

$$\begin{eqnarray} 
E(\hat{p})&=&0\times 0.16 + 0.5\times 0.48 + 1\times 0.36 = 0.6 = p\\
Var(\hat{p})&=&E[(\hat{p}-p)^2]\\
&=&0.16\times(0-0.6)^2 + 0.48\times(0.5-0.6)^2 + 0.36\times (1-0.6)^2\\
&=&0.12=\frac{0.24}{2}=\frac{p(1-p)}{n}
\end{eqnarray}$$

## Modo 1 - Exemplo $N=5$ e $n=2$

Distribuição amostral de $\hat{p}$:

```{r,echo=FALSE,fig.align='center'}
namess <- as.character(round(as.numeric(as.character(ff$Var1)),2))
barplot(ff$Prop, names.arg=namess, col="blue", main="", 
            cex.lab=1.0, cex.axis=1.0, cex.names=1.0, cex.main=2, las=2)
```


## Modo 1 - Exemplo $N=5$ e $n=3$ {.smaller}

$N^n=125$ amostras possíveis.

```{r,echo=FALSE,warning=FALSE,message=FALSE}
library(kableExtra)
aa <- expand.grid(1:5,1:5,1:5)
xx <- c(1,0,1,0,1)
phat <- unlist(apply(aa,1,function(x) mean(xx[x])))
aa$phat <- round(phat,3)
#colnames(aa) <- c("Pessoa amostrada 1","Pessoa amostrada 2","$\\hat{p}$")
kable(aa[1:25,],align = 'ccc',col.names = c("Pessoa amostrada 1","Pessoa amostrada 2","Pessoa amostrada 3","$\\hat{p}$"))
```

## Modo 1 - Exemplo $N=5$ e $n=3$ {.smaller}

```{r,echo=FALSE,warning=FALSE,message=FALSE}
kable(aa[26:50,],align = 'ccc',col.names = c("Pessoa amostrada 1","Pessoa amostrada 2","Pessoa amostrada 3","$\\hat{p}$"))
```

## Modo 1 - Exemplo $N=5$ e $n=3$ {.smaller}

```{r,echo=FALSE,warning=FALSE,message=FALSE}
kable(aa[51:75,],align = 'ccc',col.names = c("Pessoa amostrada 1","Pessoa amostrada 2","Pessoa amostrada 3","$\\hat{p}$"))
```

## Modo 1 - Exemplo $N=5$ e $n=3$ {.smaller}

```{r,echo=FALSE,warning=FALSE,message=FALSE}
kable(aa[76:100,],align = 'ccc',col.names = c("Pessoa amostrada 1","Pessoa amostrada 2","Pessoa amostrada 3","$\\hat{p}$"))
```



## Modo 1 - Exemplo $N=5$ e $n=3$ {.smaller}

```{r,echo=FALSE,warning=FALSE,message=FALSE}
kable(aa[101:125,],align = 'ccc',col.names = c("Pessoa amostrada 1","Pessoa amostrada 2","Pessoa amostrada 3","$\\hat{p}$"))
```


## Modo 1 - Exemplo $N=5$ e $n=3$ 

Distribuição **amostral** de $\hat{p}$:

```{r,echo=FALSE,warning=FALSE,message=FALSE}
ff <- as.data.frame(table(aa$phat))
ff$Prop=round(ff$Freq/(sum(ff$Freq)),3)
kable(ff[,c(1,3)],align = 'cc',col.names = c("$x$","$P(\\hat{p}=x)$"))
```

$$\begin{eqnarray} 
E(\hat{p})&=&0\times 0.064 + 0.333\times 0.288 + 0.667\times 0.432 + 1\times 0.216\\
&=& 0.6 = p\\
Var(\hat{p})&=&E[(\hat{p}-p)^2]\\
&=&0.08=\frac{0.24}{3}=\frac{p(1-p)}{n}
\end{eqnarray}$$

## Modo 1 - Exemplo $N=5$ e $n=3$

Distribuição amostral de $\hat{p}$:

```{r,echo=FALSE,fig.align='center'}
namess <- as.character(round(as.numeric(as.character(ff$Var1)),2))
barplot(ff$Prop, names.arg=namess, col="blue", main="", 
            cex.lab=1.0, cex.axis=1.0, cex.names=1.0, cex.main=2, las=2)
```


## Modo 1

<img src="figuras/image-from-rawpixel-id-408061-original.jpg" width=270 style="float: right; margin-left: 30px">

* $\mathbf{X}=(X_1,\ldots,X_N)$ é fixo

* Amostra aleatória de tamanho $n$

* $\hat{p}$ é v.a. (pelo processo de amostragem)

* $E(\hat{p})=p$

* $Var(\hat{p})=\frac{p(1-p)}{n}$



## Modo 1 - Exemplo $N=1000000$ e $n=100$



```{r,echo=FALSE,warning=FALSE,message=FALSE}
N=1000000
n=100
n1 = ceiling(N*.6)
n2= N-n1
xx <- c(rep(1,n1),rep(0,n2))
B=100000
bb <- matrix(NA,nrow=B,ncol=n)
for (i in 1:B)
{
  bb[i,] <- sample(1:N,n,replace=TRUE)
}
phat <- unlist(apply(bb,1,function(x) mean(xx[x])))
aa <- data.frame(bb)
aa$phat <- round(phat,3)
```


$p=0.6$. Distribuição **amostral** de $\hat{p}$:

```{r,echo=FALSE,warning=FALSE,message=FALSE}
ff <- as.data.frame(table(aa$phat))
ff$Prop=round(ff$Freq/(sum(ff$Freq)),3)
```


```{r,echo=FALSE,fig.align='center',message=FALSE,warning=FALSE}
library(ggplot2)
df <- data.frame(PF = aa$phat)
ggplot(df, aes(x = PF)) + 
    geom_histogram(aes(y =..density..),
                   breaks = seq(min(aa$phat), max(aa$phat), by = .01), 
                   colour = "black", 
                   fill = "blue") +  geom_vline(xintercept=0.6, color="red") + 
stat_function(fun = dnorm, args = list(mean = 0.6, sd = sqrt(0.6*.4/n)),col="red") + xlab(" ") + ylab(" ") + ylim(0,30) + xlim(0.4,0.8)
```


## Modo 1 - Exemplo $N=1000000$ e $n=1000$


```{r,echo=FALSE,warning=FALSE,message=FALSE}
N=1000000
n=1000
n1 = ceiling(N*.6)
n2= N-n1
xx <- c(rep(1,n1),rep(0,n2))
B=100000
bb <- matrix(NA,nrow=B,ncol=n)
for (i in 1:B)
{
  bb[i,] <- sample(1:N,n,replace=TRUE)
}
phat <- unlist(apply(bb,1,function(x) mean(xx[x])))
aa <- data.frame(bb)
aa$phat <- round(phat,3)
```


$p=0.6$. Distribuição **amostral** de $\hat{p}$:

```{r,echo=FALSE,warning=FALSE,message=FALSE}
ff <- as.data.frame(table(aa$phat))
ff$Prop=round(ff$Freq/(sum(ff$Freq)),3)
```


```{r,echo=FALSE,fig.align='center',message=FALSE,warning=FALSE}
df <- data.frame(PF = aa$phat)
ggplot(df, aes(x = PF)) + 
    geom_histogram(aes(y =..density..),
                   breaks = seq(min(aa$phat), max(aa$phat), by = .003), 
                   colour = "black", 
                   fill = "blue") +  geom_vline(xintercept=0.6, color="red") +
stat_function(fun = dnorm, args = list(mean = 0.6, sd = sqrt(0.6*.4/n)),col="red") + xlab(" ") + ylab(" ") + ylim(0,30)+xlim(0.4,0.8)
```



## Modo 2 {.build}

> Suponha que a resposta de uma pessoa da cidade sobre se vota ou não no candidato $A$ possa ser representada por uma **variável aleatória**. $X$ que assume o valor $1$ com probabilidade $p$ ou $0$ com probabilidade $1-p$. 

$\begin{aligned}
X &\sim Bernoulli(p)\\
\mathbb E(X) &= 1 \times P(X=1) + 0 \times P(X=0) \\ 
&= 1\times p + 0\times (1-p) = p\\
Var(X) &= \mathbb E[(X - p)^2] \\
&= (1-p)^2 \times P(X=1) + (0 - p)^2 \times P(X=0) \\
&=p(1-p)^2+(1-p)p^2\\
&= p(1-p)
\end{aligned}$

## Modo 2 

Distribuição da variável $X$: 


```{r, echo=FALSE, fig.align='center'}
p <- c(.3, .7)
## Função de Massa
par(mar=c(c(5, 4, 2, 1) + 0.1))
barplot(p, names.arg=0:1, col="blue", ylim=c(0, 1.1), ylab="P(X=x)", xlab="x",  
        cex.lab=1.5, cex.axis=1.2, cex.names=1.5, yaxt="n", main=" ")
box(bty="l", lwd=2)
axis(2, at= c(0, p, 1), labels=c(0, "1-p", "p", 1), cex.axis=1.5, las=1)
```




## Modo 2 - Exemplo $n=2$  {.smaller .build}

> Todas as combinações possíveis de amostras com $n=2$ são:

Possibilidades        | $(X_1 = 1, X_2 = 1)$ | $(X_1 = 1, X_2 = 0)$ | $(X_1 = 0, X_2 = 1)$ | $(X_1=0,X_2=0)$
----------------------|----------------------|----------------------|----------------------|-----------------
$\hat{p}=\frac{1}{n}\sum_{i=1}^nX_i$              | 1                    | 0.5                  | 0.5                  |   0
$P(X_1 = i, X_2 = j)$ | $p^2$                | $p(1-p)$                 | $(1-p)p$                 | $(1-p)^2$

<br />

> $\displaystyle \mathbb E(\hat{p}) = 1 \times p^2 + 0.5 \times p(1-p) + 0.5 \times (1-p)p + 0\times (1-p)^2= p$

> $\begin{aligned}
Var(\hat{p}) &= \mathbb E[(\hat{p} - p)^2 ] \\
&= (1 - p)^2 \times p^2 + (0.5 - p)^2 p(1-p) + (0.5 - p)^2 (1-p)p + (0 - p)^2 (1-p)^2 = \frac{p(1-p)}{2}
\end{aligned}$

> Note que: $\displaystyle \mathbb E(\hat{p}) = p = \mathbb E(X)$ e $\displaystyle Var(\hat{p}) =  \frac{Var(X)}{n}$.


## Resultado  {.build .smaller}

Seja $X$ uma v.a. com média $\mu$ e variância $\sigma^{2}$ e $X_{1}, \ldots, X_{n}$ uma amostra aleatória simples de $X$. 

> A média amostral
$$\bar X_n = \frac{1}{n}\sum_{i=1}^n X_i$$ 
tem as seguintes propriedades:

> $$\mathbb E (\bar X_n) = \mu \qquad \mbox{e} \qquad Var(\bar X_n) = \frac{\sigma^2}{n}.$$ 

(propriedade de linearidade da esperança e da variância, esta última em caso de independência)

> Ou seja, embora $\mu$ seja desconhecido, sabemos que o valor esperado da média amostral é $\mu$. 

> Além disso, conforme o tamanho amostral aumenta, a imprecisão da média amostral para estimar $\mu$ fica cada vez menor, pois $Var(\bar X) = \sigma^2/n$ é inversamente proporcional ao tamanho amostral $n$.

## Resultado  {.smaller}

Seja $X$ uma v.a. com distribuição de Bernoulli com parâmetro $p$. Sabe-se que $E(X)=p$ e $Var(X)=p(1-p)$.

A proporção amostral
$$\hat{p} = \frac{1}{n}\sum_{i=1}^n X_i$$ 
tem as seguintes propriedades:

 $$\mathbb E (\hat{p}) = p \qquad \mbox{e} \qquad Var(\hat{p}) = \frac{p(1-p)}{n}.$$ 

(propriedade de linearidade da esperança e da variância, esta última em caso de independência)

Ou seja, embora $p$ seja desconhecido, sabemos que o valor esperado da proporção amostral é $p$. 

Além disso, conforme o tamanho amostral aumenta, a imprecisão de $\hat{p}$ para estimar $p$ fica cada vez menor, pois $Var(\hat{p}) = p(1-p)/n$ é inversamente proporcional ao tamanho amostral $n$.


## Modo 2

<img src="figuras/image-from-rawpixel-id-408061-original.jpg" width=270 style="float: right; margin-left: 30px">

* $X_i\sim Bernoulli (p)$ é v.a. (o voto ou não em $A$ é considerado uma v.a.)

* Amostra aleatória de tamanho $n$

* $\hat{p}$ é v.a. (é combinação linear de v.a.'s)

* $E(\hat{p})=p$

* $Var(\hat{p})=\frac{p(1-p)}{n}$

## Modo 2 - Exemplo $n=100$


```{r,echo=FALSE,warning=FALSE,message=FALSE}
N=1000000
n=100
xx <- rbinom(N,1,0.6)
B=100000
bb <- matrix(NA,nrow=B,ncol=n)
for (i in 1:B)
{
  bb[i,] <- sample(1:N,n,replace=TRUE)
}
phat <- unlist(apply(bb,1,function(x) mean(xx[x])))
aa <- data.frame(bb)
aa$phat <- round(phat,3)
```


```{r,echo=FALSE,warning=FALSE,message=FALSE}
ff <- as.data.frame(table(aa$phat))
ff$Prop=round(ff$Freq/(sum(ff$Freq)),3)
```


```{r,echo=FALSE,fig.align='center',message=FALSE,warning=FALSE}
df <- data.frame(PF = aa$phat)
ggplot(df, aes(x = PF)) + 
    geom_histogram(aes(y =..density..),
                   breaks = seq(min(aa$phat), max(aa$phat), by = .01), 
                   colour = "black", 
                   fill = "blue") +  geom_vline(xintercept=0.6, color="red") +
stat_function(fun = dnorm, args = list(mean = 0.6, sd = sqrt(0.6*.4/n)),col="red") + xlab(" ") + ylab(" ") + ylim(0,30)+xlim(0.4,0.8)
```

## Modo 2 - Exemplo $n=1000$


```{r,echo=FALSE,warning=FALSE,message=FALSE}
N=1000000
n=1000
xx <- rbinom(N,1,0.6)
B=100000
bb <- matrix(NA,nrow=B,ncol=n)
for (i in 1:B)
{
  bb[i,] <- sample(1:N,n,replace=TRUE)
}
phat <- unlist(apply(bb,1,function(x) mean(xx[x])))
aa <- data.frame(bb)
aa$phat <- round(phat,3)
```


```{r,echo=FALSE,warning=FALSE,message=FALSE}
ff <- as.data.frame(table(aa$phat))
ff$Prop=round(ff$Freq/(sum(ff$Freq)),3)
```


```{r,echo=FALSE,fig.align='center',message=FALSE,warning=FALSE}
df <- data.frame(PF = aa$phat)
ggplot(df, aes(x = PF)) + 
    geom_histogram(aes(y =..density..),
                   breaks = seq(min(aa$phat), max(aa$phat), by = .005), 
                   colour = "black", 
                   fill = "blue") +  geom_vline(xintercept=0.6, color="red") +
stat_function(fun = dnorm, args = list(mean = 0.6, sd = sqrt(0.6*.4/n)),col="red") + xlab(" ") + ylab(" ") + ylim(0,30)+xlim(0.4,0.8)
```


## Resumo dos exemplos {.build}

> * Modo 1: repostas são "fixas", com média populacional $p$ e variância populacional $p(1-p)$.

> * Modo 2: respostas são v.a.'s $X\sim Bernoulli(p)$, $E(X)=p$, $Var(X)=p(1-p)$.

> * Em ambos os casos, a partir do momento que retiro uma amostra aleatória de tamanho $n$, temos as mesmas propriedades e comportamento para a proporção amostral $\hat{p}$: $E(\hat{p})=p$ e $Var(\hat{p})=\frac{p(1-p)}{n}$

> E, conforme $n$ aumenta, vimos nos gráficos que: $\hat{p}\sim \mathcal{N}\left(p,\frac{p(1-p)}{n}\right)$


## Estimar uma média: Salários {.build}

<img src="figuras/image-from-rawpixel-id-414919-jpeg.jpg" width=270 style="float: right; margin-left: 30px">


> * Quero saber o salário médio das pessoas de uma certa cidade (parâmetro populacional de interesse).

> * Cidade com $N$ pessoas.

> * Posso usar uma amostra e estimar usando a média amostral. 

> * Quão boa é a estimativa? É precisa? 

> * Posso pensar no problema de duas formas: Modo 1 e Modo 2.


## Modo 1

<img src="figuras/image-from-rawpixel-id-424760-original.jpg" width=270 style="float: right; margin-left: 30px">


* Cidade com $N$ pessoas.

* $X_i$ é o salário da pessoa $i$.

* $\mathbf{X}=(X_1,X_2,\ldots,X_N)$: respostas de toda a população.

* Média populacional: $\mu=\frac{1}{N}\sum_{i=1}^N X_i$

* Variância populacional: $\sigma^2=\frac{1}{N}\sum_{i=1}^N(X_i-\mu)^2$

<!-- Repare que aqui, nao estou falando de variáveis aleatórias, temos apenas dados das pessoas da cidade -->
<!-- Estou calculando a média populacional e a variancia, conforme vimos nas estatísticas descritivas -->



## Modo 1 

* $\mu$ = salário médio da população.

* $\sigma^2$ é a variância da população.

* Coletamos uma amostra aleatória de tamanho $n$.

* $\bar{X}$: média salarial na amostra.

* Quão boa é a estimativa? É precisa? 

* Se outra pessoa também coleta uma amostra aleatória de tamanho $n$ e calcula $\bar{X}$ teremos o mesmo valor?

## Modo 1 - Exemplo $N=5$ e $n=2$

$$\mathbf{X}=(X_1,X_2,\ldots,X_5)=(1000,2000,3000,4000,5000)$$

$$\mu=\frac{\sum_{i=1}^5X_i}{5}=3000$$
$$\sigma^2=\frac{1}{5}\sum_{i=1}^N(X_i-\mu)^2=2000000$$

## Modo 1 - Exemplo $N=5$ e $n=2$

Gráfico de barras (proporção) dos dados populacionais:

```{r,echo=FALSE,fig.align='center'}
namess <- c("1000","2000","3000","4000","5000")
barplot(c(rep(1/5,5)), names.arg=namess, col="blue", main="", 
            cex.lab=1.0, cex.axis=1.0, cex.names=1.0, cex.main=2, las=2)
```


## Modo 1 - Exemplo $N=5$ e $n=2$ {.smaller}

$N^n=25$ amostras possíveis.
```{r,echo=FALSE,warning=FALSE,message=FALSE}
library(kableExtra)
aa <- expand.grid(1:5,1:5)
xx <- c(1000,2000,3000,4000,5000)
phat <- unlist(apply(aa,1,function(x) mean(xx[x])))
aa$phat <- phat
kable(aa,align = 'ccc',col.names = c("Primeira pessoa","Segunda pessoa","$\\bar{X}$"))
```

## Modo 1 - Exemplo $N=5$ e $n=2$ 

Distribuição **amostral** de $\bar{X}$:

```{r,echo=FALSE,warning=FALSE,message=FALSE}
ff <- as.data.frame(table(aa$phat))
ff$Prop=ff$Freq/(sum(ff$Freq))
kable(ff[,c(1,3)],align = 'cc',col.names = c("$x$","$P(\\bar{X}=x)$"))
esp <- sum(as.numeric(as.character(ff$Var1))*ff$Prop)
vari <- sum( ((as.numeric(as.character(ff$Var1)) - esp )^2)*ff$Prop)
```

## Modo 1 - Exemplo $N=5$ e $n=2$ 


$$\begin{eqnarray} 
E(\bar{X})&=&`r esp`=\mu\\
Var(\bar{X})&=&E[(\bar{X}-\mu)^2]=`r vari`\\
&=&\frac{2000000}{2}=\frac{\sigma^2}{n}
\end{eqnarray}$$

## Modo 1 - Exemplo $N=5$ e $n=2$

Distribuição amostral de $\bar{X}$:

```{r,echo=FALSE,fig.align='center'}
namess <- as.character(round(as.numeric(as.character(ff$Var1)),2))
barplot(ff$Prop, names.arg=namess, col="blue", main="", 
            cex.lab=1.0, cex.axis=1.0, cex.names=1.0, cex.main=2, las=2)
```


## Modo 1 - Exemplo $N=5$ e $n=3$ {.smaller}

$N^n=125$ amostras possíveis.

```{r,echo=FALSE,warning=FALSE,message=FALSE}
library(kableExtra)
aa <- expand.grid(1:5,1:5,1:5)
xx <- c(1000,2000,3000,4000,5000)
phat <- unlist(apply(aa,1,function(x) mean(xx[x])))
aa$phat <- round(phat,3)
#colnames(aa) <- c("Pessoa amostrada 1","Pessoa amostrada 2","$\\hat{p}$")
kable(aa[1:25,],align = 'ccc',col.names = c("Pessoa amostrada 1","Pessoa amostrada 2","Pessoa amostrada 3","$\\bar{X}$"))
```

## Modo 1 - Exemplo $N=5$ e $n=3$ {.smaller}

```{r,echo=FALSE,warning=FALSE,message=FALSE}
kable(aa[26:50,],align = 'ccc',col.names = c("Pessoa amostrada 1","Pessoa amostrada 2","Pessoa amostrada 3","$\\bar{X}$"))
```

## Modo 1 - Exemplo $N=5$ e $n=3$ {.smaller}

```{r,echo=FALSE,warning=FALSE,message=FALSE}
kable(aa[51:75,],align = 'ccc',col.names = c("Pessoa amostrada 1","Pessoa amostrada 2","Pessoa amostrada 3","$\\bar{X}$"))
```

## Modo 1 - Exemplo $N=5$ e $n=3$ {.smaller}

```{r,echo=FALSE,warning=FALSE,message=FALSE}
kable(aa[76:100,],align = 'ccc',col.names = c("Pessoa amostrada 1","Pessoa amostrada 2","Pessoa amostrada 3","$\\bar{X}$"))
```



## Modo 1 - Exemplo $N=5$ e $n=3$ {.smaller}

```{r,echo=FALSE,warning=FALSE,message=FALSE}
kable(aa[101:125,],align = 'ccc',col.names = c("Pessoa amostrada 1","Pessoa amostrada 2","Pessoa amostrada 3","$\\bar{X}$"))
```


## Modo 1 - Exemplo $N=5$ e $n=3$ 

Distribuição **amostral** de $\bar{X}$:

```{r,echo=FALSE,warning=FALSE,message=FALSE}
ff <- as.data.frame(table(aa$phat))
ff$Prop=round(ff$Freq/(sum(ff$Freq)),3)
kable(ff[,c(1,3)],align = 'cc',col.names = c("$x$","$P(\\bar{X}=x)$"))
esp <- sum(as.numeric(as.character(ff$Var1))*ff$Prop)
vari <- sum( ((as.numeric(as.character(ff$Var1)) - esp )^2)*ff$Prop)
```


$$\begin{eqnarray} 
E(\bar{X})&=&`r esp`=\mu\\
Var(\bar{X})&=&E[(\bar{X}-\mu)^2]=`r vari`\\
&=\frac{2000000}{3}=\frac{\sigma^2}{n}
\end{eqnarray}$$


## Modo 1 - Exemplo $N=5$ e $n=3$


Distribuição amostral de $\bar{X}$:

```{r,echo=FALSE,fig.align='center'}
namess <- as.character(round(as.numeric(as.character(ff$Var1)),2))
barplot(ff$Prop, names.arg=namess, col="blue", main="", 
            cex.lab=1.0, cex.axis=1.0, cex.names=1.0, cex.main=2, las=2)
```


## Modo 1

<img src="figuras/image-from-rawpixel-id-414919-jpeg.jpg" width=270 style="float: right; margin-left: 30px">

* $\mathbf{X} = (X_1,\ldots,X_N)$ é fixo

* Amostra aleatória de tamanho $n$

* $\bar{X}$ é v.a.

* $E(\bar{X})=\mu$

* $Var(\bar{X})=\frac{\sigma^2}{n}$




## Modo 1 - Exemplo $N=1000000$ e $n=100$



```{r,echo=FALSE,warning=FALSE,message=FALSE}
N=1000000
n=100
xx <- c(rep(1000,N/5),rep(2000,N/5),rep(3000,N/5),rep(4000,N/5),rep(5000,N/5))
mu=mean(xx)
vari = var(xx) * (N-1)/N
B=100000
bb <- matrix(NA,nrow=B,ncol=n)
for (i in 1:B)
{
  bb[i,] <- sample(1:N,n,replace=TRUE)
}
phat <- unlist(apply(bb,1,function(x) mean(xx[x])))
aa <- data.frame(bb)
aa$phat <- round(phat,3)
```


$\mu=3000$. Distribuição **amostral** de $\bar{X}$:

```{r,echo=FALSE,warning=FALSE,message=FALSE}
ff <- as.data.frame(table(aa$phat))
ff$Prop=round(ff$Freq/(sum(ff$Freq)),3)
```


```{r,echo=FALSE,fig.align='center',message=FALSE,warning=FALSE}
library(ggplot2)
df <- data.frame(PF = aa$phat)
ggplot(df, aes(x = PF)) + 
    geom_histogram(aes(y =..density..),
                   breaks = seq(min(aa$phat), max(aa$phat), by = 10), 
                   colour = "black", 
                   fill = "blue") +  geom_vline(xintercept=mu, color="red") + 
stat_function(fun = dnorm, args = list(mean = mu, sd = sqrt(vari/n)),col="red") + xlab(" ") + ylab(" ") + ylim(0,0.01) + xlim(2400,3600)
```


## Modo 1 - Exemplo $N=1000000$ e $n=1000$


```{r,echo=FALSE,warning=FALSE,message=FALSE}
N=1000000
n=1000
xx <- c(rep(1000,N/5),rep(2000,N/5),rep(3000,N/5),rep(4000,N/5),rep(5000,N/5))
mu=mean(xx)
vari = var(xx) * (N-1)/N
B=100000
bb <- matrix(NA,nrow=B,ncol=n)
for (i in 1:B)
{
  bb[i,] <- sample(1:N,n,replace=TRUE)
}
phat <- unlist(apply(bb,1,function(x) mean(xx[x])))
aa <- data.frame(bb)
aa$phat <- round(phat,3)
```


$\mu=3000$. Distribuição **amostral** de $\bar{X}$:

```{r,echo=FALSE,warning=FALSE,message=FALSE}
ff <- as.data.frame(table(aa$phat))
ff$Prop=round(ff$Freq/(sum(ff$Freq)),3)
```


```{r,echo=FALSE,fig.align='center',message=FALSE,warning=FALSE}
df <- data.frame(PF = aa$phat)
ggplot(df, aes(x = PF)) + 
    geom_histogram(aes(y =..density..),
                   breaks = seq(min(aa$phat), max(aa$phat), by = 10), 
                   colour = "black", 
                   fill = "blue") +  geom_vline(xintercept=mu, color="red") +
stat_function(fun = dnorm, args = list(mean = mu, sd = sqrt(vari/n)),col="red") + xlab(" ") + ylab(" ") + ylim(0,0.01) + xlim(2400,3600)
```



## Modo 2

Suponha que o salário de uma pessoa possa ser representado por uma **variável aleatória** uniforme discreta assumindo os valores 1000,2000, 3000, 4000 ou 5000. 

$\begin{aligned}
\mu=\mathbb E(X) &= \frac{1000+2000+3000+4000+5000}{5}=3000 \\ 
\sigma^2=Var(X) &= \frac{1}{5}[(1000-3000)^2+(2000-3000)^2+(3000-3000)^2\\
&+(4000-3000)^2+(5000-3000)^2]\\
&= 2000000
\end{aligned}$

## Modo 2 

Distribuição da variável $X$ (do salário de cada indivíduo da população): 

```{r,echo=FALSE,fig.align='center'}
namess <- c("1000","2000","3000","4000","5000")
barplot(c(rep(1/5,5)), names.arg=namess, col="blue", main="", 
            cex.lab=1.0, cex.axis=1.0, cex.names=1.0, cex.main=2, las=2)
```




## Modo 2 - Exemplo $n=2$  {.smaller}


> $\displaystyle \mathbb E(\bar{X}) = \frac{1}{n}\sum_{i=1}^n \mathbb E (X_i)= E(X)=\mu=3000$

> $\begin{aligned}
Var(\bar{X}) &= \frac{1}{n}\sum_{i=1}^n Var (X_i)= \frac{Var(X)}{n}=\frac{\sigma^2}{n}=1000000\\
\end{aligned}$

(propriedades de linearidade da esperança e variância (a.a.))

## Resultado  {.build .smaller}

Seja $X$ uma v.a. com média $\mu$ e variância $\sigma^{2}$ e $X_{1}, \ldots, X_{n}$ uma amostra aleatória simples de $X$. 

A média amostral
$$\bar X_n = \frac{1}{n}\sum_{i=1}^n X_i$$ 
tem as seguintes propriedades:

> $$\mathbb E (\bar X_n) = \mu \qquad \mbox{e} \qquad Var(\bar X_n) = \frac{\sigma^2}{n}.$$ 

(propriedade de linearidade da esperança e da variância, esta última em caso de independência)

Ou seja, embora $\mu$ seja desconhecido, sabemos que o valor esperado da média amostral é $\mu$. 

Além disso, conforme o tamanho amostral aumenta, a imprecisão da média amostral para estimar $\mu$ fica cada vez menor, pois $Var(\bar X) = \sigma^2/n$ é inversamente proporcional ao tamanho amostral $n$.


## Modo 2 - Exemplo $n=100$


```{r,echo=FALSE,warning=FALSE,message=FALSE}
N=1000000
n=100
xx=sample(x=c(1000,2000,3000,4000,5000),size=N,replace=TRUE)
B=100000
bb <- matrix(NA,nrow=B,ncol=n)
for (i in 1:B)
{
  bb[i,] <- sample(1:N,n,replace=TRUE)
}
phat <- unlist(apply(bb,1,function(x) mean(xx[x])))
aa <- data.frame(bb)
aa$phat <- round(phat,3)
mu=mean(xx)
vari = var(xx) * (N-1)/N
```


```{r,echo=FALSE,warning=FALSE,message=FALSE}
ff <- as.data.frame(table(aa$phat))
ff$Prop=round(ff$Freq/(sum(ff$Freq)),3)
```


```{r,echo=FALSE,fig.align='center',message=FALSE,warning=FALSE}
df <- data.frame(PF = aa$phat)
ggplot(df, aes(x = PF)) + 
    geom_histogram(aes(y =..density..),
                   breaks = seq(min(aa$phat), max(aa$phat), by = 10), 
                   colour = "black", 
                   fill = "blue") +  geom_vline(xintercept=mu, color="red") +
stat_function(fun = dnorm, args = list(mean = mu, sd = sqrt(vari/n)),col="red") + xlab(" ") + ylab(" ") + ylim(0,0.01)+xlim(2000,4000)
```

## Modo 2 - Exemplo $n=1000$


```{r,echo=FALSE,warning=FALSE,message=FALSE}
N=1000000
n=1000
xx=sample(x=c(1000,2000,3000,4000,5000),size=N,replace=TRUE)
B=100000
bb <- matrix(NA,nrow=B,ncol=n)
for (i in 1:B)
{
  bb[i,] <- sample(1:N,n,replace=TRUE)
}
phat <- unlist(apply(bb,1,function(x) mean(xx[x])))
aa <- data.frame(bb)
aa$phat <- round(phat,3)
mu=mean(xx)
vari = var(xx) * (N-1)/N
```


```{r,echo=FALSE,warning=FALSE,message=FALSE}
ff <- as.data.frame(table(aa$phat))
ff$Prop=round(ff$Freq/(sum(ff$Freq)),3)
```


```{r,echo=FALSE,fig.align='center',message=FALSE,warning=FALSE}
df <- data.frame(PF = aa$phat)
ggplot(df, aes(x = PF)) + 
    geom_histogram(aes(y =..density..),
                   breaks = seq(min(aa$phat), max(aa$phat), by = 10), 
                   colour = "black", 
                   fill = "blue") +  geom_vline(xintercept=mu, color="red") +
stat_function(fun = dnorm, args = list(mean = mu, sd = sqrt(vari/n)),col="red") + xlab(" ") + ylab(" ") + ylim(0,0.01)+xlim(2000,4000)
```


## Resumo dos exemplos {.smaller}

Temos uma população com média (proporção) $\mu$ ($p$) e variância $\sigma^2$ desconhecida. 

Retira-se uma amostra aleatória de tamanho $n$ e calcula-se a média (ou proporção) amostral $\bar{X}$ (ou $\hat{p}$) para estimar o parâmetro populacional desconhecido $\mu$ (ou $p$).

Temos as propriedades:


$$E(\bar{X})=\mu \quad \quad Var(\bar{X})=\frac{\sigma^2}{n}$$

$$E(\hat{p})=p\quad \quad Var(\hat{p})=\frac{p(1-p)}{n}$$

E, conforme $n$ aumenta, pelos gráficos, parece que a distribuição amostral de $\bar{X}$ e $\hat{p}$ se aproxima da normal:

$$\bar{X}\sim \mathcal{N}\left(\mu,\frac{\sigma^2}{n}\right) \quad \quad \hat{p}\sim \mathcal{N}\left(p,\frac{p(1-p)}{n}\right)$$


# Teorema do Limite Central

## Teorema do Limite Central {.build}

Temos a esperança e a variância da média amostral $\bar X$: $\mathbb E(\bar X) = \mu$ e $Var(\bar X) = \frac{\sigma^2}{n}$.

> No entanto, para conhecermos a distribuição de probabilidade de $\bar X$, como foi feito no exemplo anterior, é preciso conhecer todos os valores possíveis de $X$ e suas respectivas probabilidades. 

> Mas, se conhecermos tudo isso, não precisamos fazer amostragem nem inferência: saberemos tudo o que desejarmos daquela população!

> O exemplo anterior foi um caso hipotético apenas para demonstrar como a média amostral $\bar X$ se comporta quando realizamos a amostragem.

> Na prática, não teremos informações suficientes para de fato descrevermos a distribuição exata de $\bar X$.





## Leituras

* [Ross](http://www.sciencedirect.com/science/article/pii/B9780123743886000077): capítulo 7. 
* [OpenIntro](https://www.openintro.org/stat/textbook.php): seção 4.1.
* Magalhães: capítulo 7.

<br /><br />

Slides produzidos pelos professores:

* Samara Kiihl

* Tatiana Benaglia

* Benilton Carvalho